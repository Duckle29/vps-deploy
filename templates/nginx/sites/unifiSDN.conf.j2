server {
		server_name ubnt.{{ domain }};
		listen 80;

		location /inform {
				access_log off;
				log_not_found off;

				proxy_pass http://localhost:8080/inform;
				proxy_set_header Host $http_host;
				proxy_set_header X-Real-IP $remote_addr;
				proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
				proxy_set_header X-Forwarded-Proto $scheme;
		}
 
		location / {
				return 301 https://$host$request_uri;
		}
}

server {
	server_name ubnt.{{ domain }};

	listen 443 ssl http2;
	include snippets/ssl;

	client_max_body_size 0;

	location / {
		set $upstream_unifi ubnt.{{ domain }};
		proxy_pass https://localhost:8443/;

		proxy_set_header Host	$host;
	        proxy_set_header		X-Forwarded-Proto   $scheme;
	        proxy_intercept_errors  on;
	        proxy_http_version      1.1;
	        proxy_set_header 		Upgrade $http_upgrade;
		    proxy_set_header		Connection "Upgrade";
		    proxy_set_header 		X-Real-IP $remote_addr;
        	proxy_set_header 		X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}